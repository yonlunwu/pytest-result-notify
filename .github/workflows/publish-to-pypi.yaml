name: Publish Python ğŸ distributions ğŸ‘› to PyPI  # å·¥ä½œæµåç§°

on:
  push:  # å½“æœ‰ä»£ç æ¨é€æ—¶è§¦å‘
    tags:  # ä»…åœ¨æ¨é€æ ‡ç­¾æ—¶è§¦å‘
      - '*'  # åŒ¹é…æ‰€æœ‰æ ‡ç­¾

jobs:
  build-publish:  # ä»»åŠ¡ ID
    name: Build and Publish to PyPI  # ä»»åŠ¡åç§°
    runs-on: ubuntu-latest  # æŒ‡å®šè¿è¡Œç¯å¢ƒä¸ºæœ€æ–°çš„ Ubuntu

    # permissions:
    #   id-token: write  # å…è®¸ OIDC è®¤è¯çš„å†™å…¥æƒé™

    steps:  # æ­¥éª¤å®šä¹‰
      - uses: actions/checkout@v2  # æ£€å‡ºä»£ç 
      
      - name: Set up Python  # è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v2  # ä½¿ç”¨ setup-python Action
        with:
          python-version: '3.8'  # æŒ‡å®šå®‰è£… Python ç‰ˆæœ¬

      - name: Install pypa/build  # å®‰è£…æ„å»ºå·¥å…·
        run: python -m pip install build --user  # ä½¿ç”¨ pip å®‰è£… build

      - name: Build a binary wheel and a source tar package  # æ„å»ºåŒ…
        run: python -m build --wheel --outdir dist/  # ç”ŸæˆäºŒè¿›åˆ¶è½®å­å’Œæºä»£ç åŒ…

      - name: Publish to PyPI  # å‘å¸ƒåˆ° PyPI
        if: startsWith(github.ref, 'refs/tags')  # ä»…åœ¨æ¨é€æ ‡ç­¾æ—¶æ‰§è¡Œ
        uses: pypa/gh-action-pypi-publish@release/v1  # é€šå¸¸æŒ‡å‘è¯¥ç‰ˆæœ¬çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ
        # uses: pypa/gh-action-pypi-publish@master  # æŒ‡å‘å¼€å‘ä¸­çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¯èƒ½åŒ…å«æœªç»å……åˆ†æµ‹è¯•çš„æ–°ç‰¹æ€§æˆ–ä¿®å¤ï¼Œå¯èƒ½å¼•å…¥ä¸ç¨³å®šå› ç´ ã€‚

        with:
          # repository-url: ${{ secrets.PYPI_API_TOKEN_163 }}  # ä½¿ç”¨ GitHub Secrets ä¸­çš„ PyPI API ä»¤ç‰Œ
          user: __token__  # ä½¿ç”¨ token ä½œä¸ºç”¨æˆ·å
          password: ${{ secrets.PYPI_API_TOKEN_163 }}  # ä½¿ç”¨ GitHub Secrets ä¸­çš„ PyPI API ä»¤ç‰Œ